class Onbrd{constructor(t={}){this.steps=t.steps||[],this.colors=Object.assign({primary:"#0066ff",dark:"#222222",overlay:"rgba(10,10,10,0.1)",background:"rgba(255,255,255,0.92)"},t.colors||{}),this.font=t.font||"Inter, sans-serif",this.labels=Object.assign({next:"Next →",prev:"← Back",skip:"Skip",close:"✖",step:"Step",of:"of",confirmExit:"Do you really want to exit this onboarding?"},t.labels||{}),this.onStart=t.onStart||null,this.onShowStep=t.onShowStep||null,this.onComplete=t.onComplete||function(){},this.onExit=t.onExit||null,this.onError=t.onError||null,this.currentStepId=0,this.stepMap={},this.storageKey=t.storageKey||"onbrd_onboarding_progress",this.popperInstance=null,this.forceExitConfirm=t.forceExitConfirm||!1,this._safeBackPerStep=[],this.storage=t&&t.storage||window.localStorage,this.stepElements=[],this.active=!1,this.paused=!1,this.nextCheckInterval=null,this.crossPageEnabled=!1,this._checkResumeBound=null,this._origPushState=null,this._mutationObs=null,this._resizeObs=null,this.autoStart=!1!==t.autoStart,this.autoStart&&window.addEventListener("DOMContentLoaded",()=>this.start()),this._buildOverlay(),this._buildModal(),this._buildTooltip(),document.documentElement.style.setProperty("--onb-primary",this.colors.primary),document.documentElement.style.setProperty("--onb-dark",this.colors.dark),document.documentElement.style.setProperty("--onb-font",this.font),document.documentElement.style.setProperty("--onb-overlay",this.colors.overlay),document.documentElement.style.setProperty("--onb-bg",this.colors.background),document.documentElement.style.setProperty("--onb-overlay",this.colors.overlay),document.documentElement.style.setProperty("--onb-bg",this.colors.background),this.steps.forEach((t,e)=>{void 0!==t.stepId&&(this.stepMap[t.stepId]=e),this.stepElements[e]=t.selector?document.querySelector(t.selector):null})}_ensureDOMReady(t){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t()):t()}_buildOverlay(){this.darken=document.createElement("div"),this.darken.className="onb-onboard-darken",this.darken.setAttribute("aria-hidden","true"),this.darken.style.display="none",this.darken.addEventListener("click",()=>this._confirmExit()),document.body.appendChild(this.darken)}_buildModal(){this.modal=document.createElement("div"),this.modal.className="onb-onboard-modal",this.modal.setAttribute("role","dialog"),this.modal.setAttribute("aria-modal","true"),this.modal.setAttribute("aria-hidden","true"),this.modal.innerHTML=`
            <div class="onb-onboard-header">
                <div class="onb-onboard-progress-bar">
                    <div class="onb-onboard-progress"></div>
                </div>
                <div class="onb-onboard-step-counter"></div>
                <button class="onb-btn-skip">${this.labels.skip}</button>
                <button class="onb-btn-close">${this.labels.close}</button>
            </div>
            <div class="onb-onboard-inner">
                <div class="onb-onboard-text"></div>
                <div class="onb-onboard-video"></div>
                <div class="onb-onboard-buttons">
                    <button class="onb-btn-prev">${this.labels.prev}</button>
                    <button class="onb-btn-next">${this.labels.next}</button>
                </div>
            </div>
        `,document.body.appendChild(this.modal),this.modal.querySelector(".onb-btn-next").addEventListener("click",()=>this.nextStep()),this.modal.querySelector(".onb-btn-prev").addEventListener("click",()=>this.prevStep()),this.modal.querySelector(".onb-btn-close").addEventListener("click",()=>this._confirmExit()),this.modal.querySelector(".onb-btn-skip").addEventListener("click",()=>this.skip())}_buildTooltip(){document.documentElement.style.setProperty("--onb-primary",this.colors.primary),document.documentElement.style.setProperty("--onb-dark",this.colors.dark),document.documentElement.style.setProperty("--onb-font",this.font),this.tooltipWrapper=document.createElement("div"),this.tooltipWrapper.className="onb-tooltip-wrapper",this.tooltipWrapper.setAttribute("role","tooltip"),this.tooltipWrapper.setAttribute("aria-hidden","true"),this.tooltip=document.createElement("div"),this.tooltip.className="onb-tooltip",this.arrow=document.createElement("div"),this.arrow.className="onb-tooltip-arrow",this.tooltipWrapper.appendChild(this.tooltip),this.tooltipWrapper.appendChild(this.arrow),document.body.appendChild(this.tooltipWrapper)}start(){if(this.storageKey){let t=this.storage.getItem(this.storageKey);null===t||isNaN(parseInt(t,10))?this.currentStepId=0:this.currentStepId=parseInt(t,10)}else this.currentStepId=0;this.active=!0,this.paused=!1,this.onStart&&this.onStart(),this._ensureDOMReady(()=>this._showStep())}async _showStep(){if(this.darken.style.display="block",this.darken.classList.add("show"),this.darken.setAttribute("aria-hidden","false"),this._stopObservers(),this.nextCheckInterval&&(clearInterval(this.nextCheckInterval),this.nextCheckInterval=null),this.currentStepId>=this.steps.length){this.end();return}this._currentStep&&this._currentStep.onLeave&&this._currentStep.onLeave();let t=this.steps[this.currentStepId];try{await this._waitForElement(t.waitForElement)}catch(e){this.onError&&this.onError(e,t)}if(t.selector&&(this.stepElements[this.currentStepId]=document.querySelector(t.selector)),t.skipHiddenElement&&t.selector){let s=this.stepElements[this.currentStepId];if(!s||"none"===window.getComputedStyle(s).display){!s&&this.onError&&this.onError(Error("Element not found: "+t.selector),t),this.currentStepId+=1,this._showStep();return}}t.selector&&!this.stepElements[this.currentStepId]&&this.onError&&this.onError(Error("Element not found: "+t.selector),t),this._currentStep=t,t.onEnter&&t.onEnter(),this.onShowStep&&this.onShowStep(t,this.currentStepId),this._clearHighlights(),this.darken.classList.add("show"),this.darken.setAttribute("aria-hidden","false");let i=Math.round((this.currentStepId+1)/this.steps.length*100);this.modal.querySelector(".onb-onboard-progress").style.width=i+"%";let r=`${this.labels.step} ${this.currentStepId+1} ${this.labels.of} ${this.steps.length}`;"main"===t.type?(this.modal.style.display="flex",this.modal.setAttribute("aria-hidden","false"),this.tooltipWrapper.style.display="none",this.tooltipWrapper.setAttribute("aria-hidden","true"),this.modal.querySelector(".onb-onboard-step-counter").textContent=r,this._showMain(t)):(this.modal.style.display="none",this.modal.setAttribute("aria-hidden","true"),this.tooltipWrapper.style.display="block",this.tooltipWrapper.setAttribute("aria-hidden","false"),this._showTooltip(t,r));let o="tooltip"===t.type&&!0===t.captureClick;this._safeBackPerStep[this.currentStepId]=!o||o&&t.goBack,this.storageKey&&this.storage.setItem(this.storageKey,this.currentStepId),"function"==typeof this._updateStepInUrl&&this._updateStepInUrl()}_showMain(t){let e=!(this.currentStepId>0)||this._safeBackPerStep[this.currentStepId-1];this.modal.querySelector(".onb-onboard-text").innerHTML=t.html||"",this.modal.querySelector(".onb-onboard-video").innerHTML=t.video?`<video src="${t.video}" controls style="max-width: 100%"></video>`:"",this.modal.querySelector(".onb-btn-prev").style.display=this.currentStepId>0&&e?"inline-flex":"none";let s=this.modal.querySelector(".onb-btn-next");if(s.disabled=!1,t.nextCondition){s.disabled=!0,s.setAttribute("aria-disabled","true");let i=()=>Promise.resolve(t.nextCondition()).catch(()=>!1);this.nextCheckInterval=setInterval(()=>{i().then(t=>{t&&(s.disabled=!1,s.removeAttribute("aria-disabled"),clearInterval(this.nextCheckInterval),this.nextCheckInterval=null)})},200)}t.onNext?this._onNext=t.onNext:this._onNext=null}_showTooltip(t,e){let s=this.stepElements[this.currentStepId];if(!s)return;s.classList.add("onb-onboard-highlight"),s.scrollIntoView({behavior:"smooth",block:"center"});let i=!(this.currentStepId>0)||this._safeBackPerStep[this.currentStepId-1];if(this.tooltip.innerHTML=`
            <div class="onb-tooltip-text">${t.text||""}</div>
            ${t.moreInfo?`<div class="onb-tooltip-more">${t.moreInfo}</div>`:""}
            <div class="onb-tooltip-buttons">
                ${i?`<button class="onb-btn-prev">${this.labels.prev}</button>`:""}
                ${t.captureClick?"":`<button class="onb-btn-next">${this.labels.next}</button>`}
            </div>
            <div class="onb-tooltip-step-counter">${e}</div>
        `,this.popperInstance&&this.popperInstance.destroy(),this.popperInstance=Popper.createPopper(s,this.tooltipWrapper,{placement:t.position||"bottom",modifiers:[{name:"offset",options:{offset:[0,12]}},{name:"arrow",options:{element:this.arrow}},{name:"preventOverflow",options:{padding:8}},{name:"flip",options:{fallbackPlacements:["top","right","left","bottom"]}}]}),this._startObservers(s,t),t.typewriter&&"INPUT"===s.tagName&&(t.autoFocus&&s.focus(),this._typewriter(s,t.typewriter)),t.captureClick){let r=e=>{e.stopPropagation();let i=!1!==t.passThrough;i||e.preventDefault(),s.removeEventListener("click",r),t.onAction&&t.onAction(),this.nextStep(),i&&setTimeout(()=>s.click(),0)};s.addEventListener("click",r)}let o=this.tooltip.querySelector(".onb-btn-next");if(o&&(o.addEventListener("click",()=>{this._onNext&&this._onNext(),this.nextStep()}),t.nextCondition)){o.disabled=!0,o.setAttribute("aria-disabled","true");let n=()=>Promise.resolve(t.nextCondition()).catch(()=>!1);this.nextCheckInterval=setInterval(()=>{n().then(t=>{t&&(o.disabled=!1,o.removeAttribute("aria-disabled"),clearInterval(this.nextCheckInterval),this.nextCheckInterval=null)})},200)}let a=this.tooltip.querySelector(".onb-btn-prev");a&&a.addEventListener("click",()=>{let t=this.steps[this.currentStepId-1];"tooltip"===t.type&&t.captureClick&&t.goBack?t.goBack(()=>this.prevStep()):this.prevStep()})}_typewriter(t,e){let s=0,i=setInterval(()=>{t.value=e.substring(0,s),++s>e.length&&clearInterval(i)},80)}nextStep(){this.currentStepId+=1,this._ensureDOMReady(()=>this._showStep())}prevStep(){this.currentStepId>0&&(this._currentStep&&this._currentStep.onPrev&&this._currentStep.onPrev(),this.currentStepId-=1),this._ensureDOMReady(()=>this._showStep())}skip(){this.end()}end(){this.nextCheckInterval&&(clearInterval(this.nextCheckInterval),this.nextCheckInterval=null),this._stopObservers(),this._clearHighlights(),this.darken.classList.remove("show"),this.darken.setAttribute("aria-hidden","true"),this.modal.style.display="none",this.modal.setAttribute("aria-hidden","true"),this.tooltipWrapper.style.display="none",this.tooltipWrapper.setAttribute("aria-hidden","true"),this.storage.removeItem(this.storageKey),this.darken.classList.remove("show"),this.darken.setAttribute("aria-hidden","true"),this.darken.style.display="none",this.onComplete(),this.onExit&&this.onExit(),this.active=!1,this.paused=!1,this.currentStepId=0}_clearHighlights(){document.querySelectorAll(".onb-onboard-highlight").forEach(t=>{t.classList.remove("onb-onboard-highlight")})}_confirmExit(){this.forceExitConfirm?confirm(this.labels.confirmExit)&&this.end():this.end()}async _waitForElement(t){if(t){if("string"==typeof t)for(;!document.querySelector(t);)await new Promise(t=>setTimeout(t,200));else"function"==typeof t&&await t()}}goToStep(t){let e=-1;"string"==typeof t?e=this.stepMap[t]:"number"==typeof t&&(e=t),e>=0&&e<this.steps.length&&(this.currentStepId=e,this._ensureDOMReady(()=>this._showStep()))}restart(){this.storage.removeItem(this.storageKey),this.currentStepId=0,this.active=!0,this.paused=!1,this.onStart&&this.onStart(),this._ensureDOMReady(()=>this._showStep())}pause(){this.active&&!this.paused&&(this.paused=!0,this._clearHighlights(),this.darken.classList.remove("show"),this.darken.setAttribute("aria-hidden","true"),this.modal.style.display="none",this.tooltipWrapper.style.display="none")}resume(){this.active&&this.paused&&(this.paused=!1,this._ensureDOMReady(()=>this._showStep()))}isActive(){return this.active&&!this.paused}_startObservers(t,e){if(this._stopObservers(),!t)return;let s=()=>{t.isConnected&&"none"!==window.getComputedStyle(t).display||(this._stopObservers(),!1!==e.skipOnDisappear?this.nextStep():this.pause())};this._mutationObs=new MutationObserver(s),this._mutationObs.observe(document.body,{childList:!0,subtree:!0}),this._resizeObs=new ResizeObserver(s),this._resizeObs.observe(t)}_stopObservers(){this._mutationObs&&(this._mutationObs.disconnect(),this._mutationObs=null),this._resizeObs&&(this._resizeObs.disconnect(),this._resizeObs=null)}}"undefined"!=typeof module&&(module.exports=Onbrd);